
@{
    ViewData["Title"] = "ProductManager";
}

<h1>Quản lý sản phẩm</h1>

<div class=" row" style="margin-bottom:10px">
    <input type="text" class="form-control" placeholder="Tìm kiếm theo tên sản phẩm" style="width:30%" onchange="ReloadPagination()" id="searchName">
</div>
<div class=" row">
    <table class="table">
        <thead>
            <tr>
                <th>
                    Tên
                </th>
                <th>
                    Mã
                </th>
                <th>
                    Ảnh
                </th>
                <th>
                    Giá gốc
                </th>
                <th>
                    Giá bán
                </th>
                <th>
                    Số lượng
                </th>
                <th>
                    Chất liệu
                </th>
                <th>
                    Loại sản phẩm
                </th>
                <th>
                    Trạng thái
                </th>
                <th></th>
            </tr>
        </thead>
        <tbody id="list_products">
        </tbody>
    </table>
</div>
<div class="d-flex justify-content-end">
    <a asp-action="AddSanPham" class="btn btn-primary">Thêm sản phẩm</a>
</div>
<div class="row">
    <div class="col-lg-12 d-flex justify-content-center">
        <ul id="pagination-demo" class="pagination"></ul>
    </div>
</div>
<script src="/js/jquery-3.3.1.min.js"></script>
<script>
    var pageIndex = 1;
    var pagesize = 10;
    $(document).ready(function () {
        loadsp();
    });
    function loadsp() {
        var searchName = SearchName();
        var request = { page: pageIndex, pageSize: pagesize, search: searchName };
        $.ajax({
            url: "/Admin/ShowProduct",
            type: "GET",
            data: request,
            success: function (response) {
                $("#list_products").empty();
                $.each(response.data, function (i, item) {
                    if (item.trangThai == 1)
                        $("#list_products").append(`<tr><td>${item.ten}</td><td>${item.ma}</td><td><img src="/img/product/${item.anh}" style="width:70px;height:70px" /></td><td>${item.giaGoc}</td><td>${item.giaBan}</td><td>${item.soLuong}</td><td>${item.chatLieu}</td><td>${item.loaiSP}</td><td><span style="color:green">Hoạt động</span></td><td style="width:200px"><a href='/Admin/ProductDetail?idSanPham=${item.id}' class="btn btn-primary">Chi tiết</a><a href='/Admin/UpdateTrangThaiSanPham?idSanPham=${item.id}&trangThai=0' class="btn btn-danger">Xoá</a></td></tr>`);
                    else {
                        $("#list_products").append(`<tr><td>${item.ten}</td><td>${item.ma}</td><td><img src="/img/product/${item.anh}" style="width:70px;height:70px" /></td><td>${item.giaGoc}</td><td>${item.giaBan}</td><td>${item.soLuong}</td><td>${item.chatLieu}</td><td>${item.loaiSP}</td><td><span style="color:red">Không hoạt động</span></td><td style="width:200px"><a href='/Admin/ProductDetail?idSanPham=${item.id}' class="btn btn-primary">Chi tiết</a><a href='/Admin/UpdateTrangThaiSanPham?idSanPham=${item.id}&trangThai=1'  class="btn btn-success">Hoàn tác</a></td></tr>`);
                    }
                });
                pagingsp(response.total, function () {
                    loadsp();
                });
            },
            error: function (err) {
                console.log('Error:', err);
            }
        });
    }
    function pagingsp(totalrow, callback) {
        var totalgages = Math.ceil(totalrow / pagesize);
        $("#pagination-demo").twbsPagination({
            totalPages: totalgages,
            visiblePages: 7,
            onPageClick: function (event, page) {
                pageIndex = page;
                setTimeout(callback, 200);
            }
        });
    }
    function ReloadPagination() {
        $("#pagination-demo").twbsPagination('destroy');
        loadsp();
    }
    function SearchName() {
        var name = document.getElementById("searchName").value;
        return name;
    }
</script>

