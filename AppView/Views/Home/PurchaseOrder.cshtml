@using AppData.ViewModels;
@model List<DonMuaViewModel>
@{
    Layout = "_Layout";
}
<style>
    #navbar {
        display:flex;
        justify-content: space-evenly;
        align-items:center;
        padding: 10px 0px 10px 0px;
        background-color:white;
        margin-bottom:24px;
    }

    #AllHoaDon{
        display: flex;
        justify-content: space-evenly;
        align-items: center;
        background-color: white;
    }
    #navbar div label {
        margin:0px;
    }

    #navbar div label span{
        cursor: pointer;
        padding:10px;
    }
    #navbar input[type="radio"]{
        display:none;
    }

    #navbar label input[type="radio"]:checked ~ span{
        border-bottom: 1px solid black;
    }
</style>
<section style="background-color: #eee;">
    <div class="container py-5">
        <div class="row">
            <div class="col">
                <nav aria-label="breadcrumb" class="bg-light rounded-3 p-3 mb-4">
                    <ol class="breadcrumb mb-0">
                        <li class="breadcrumb-item"><a href="#">Home</a></li>
                        <li class="breadcrumb-item active" aria-current="page">Đơn mua</li>
                    </ol>
                </nav>
            </div>
        </div>
        <div class="row">
            <div class="col">
                <div onchange="LocHoaDon()" id="navbar">
                    <div >
                        <label>
                            <input type="radio" name="menu" value="0" checked/>
                            <span>Tất cả</span>
                        </label>
                    </div>
                    <div >
                        <label>
                            <input type="radio" name="menu" value="2" />
                            <span>Chờ bàn giao</span>
                        </label>
                    </div>
                    <div >
                        <label>
                            <input type="radio" name="menu" value="3" />
                            <span>Đang giao</span>
                        </label>
                    </div>
                    <div >
                        <label>
                            <input type="radio" name="menu" value="6" />
                            <span>Hoàn thành</span>
                        </label>
                    </div>
                    <div >
                        <label>
                            <input type="radio" name="menu" value="7"/>
                            <span>Đã hủy</span>
                        </label>
                    </div>
                    <div >
                        <label>
                            <input type="radio" name="menu" value="5"/>
                            <span>Trả hàng hoàn tiền</span>
                        </label>
                    </div>
                </div>
                
            </div>
        </div>
        <div id="AllHoaDon" style="display:inherit;">
            <table class="table">
                <thead>
                    <tr>
                        <th scope="col">Mã đơn hàng</th>
                        <th scope="col">Ngày Đặt</th>
                        <th scope="col">Thành tiền</th>
                        <th scope="col">Trạng thái giao hàng</th>
                        <th scope="col">Loại hóa đơn</th>
                    </tr>
                </thead>
                <tbody id="DShoaDon">
                    @*@foreach (var item in Model)
                    {
                        <tr>
                            <th scope="row"><a href="PurchaseOrderDetail?idHoaDon=@item.IDHoaDon">@item.MaHD</a></th>
                            <td>@item.NgayTao</td>
                            <td>@Convert.ToInt32(item.TongTien).ToString("n0") VNĐ</td>
                            @if (item.TrangThaiGiaoHang == 2)
                            {
                                <td>Chờ xác nhận</td>
                            }
                            else if (item.TrangThaiGiaoHang == 3)
                            {
                                <td>Đang giao</td>
                            }
                            else if (item.TrangThaiGiaoHang == 6)
                            {
                                <td>Giao hàng thành công</td>
                            }
                            else if (item.TrangThaiGiaoHang == 7)
                            {
                                <td>Đơn hủy</td>
                            }
                            else if (item.TrangThaiGiaoHang == 8)
                            {
                                <td>Chờ xác nhận - Hủy</td>
                            }
                            else if (item.TrangThaiGiaoHang == 9)
                            {
                                <td>Chờ xác nhận - Đổi trả</td>
                            }
                            else
                            {
                                <td>Chờ xác nhận</td>
                            }
                            @if (item.TrangThaiLSTD == 1)
                            {
                                <td>@item.Diem</td>
                            }else{
                                <td>Người dùng sử dụng điểm</td>
                            }
                            
                        </tr>
                    }*@
                </tbody>
                
            </table>
        </div>
        <div class="row">
            <div class="col-lg-12">
                
                    <ul id="pagination-demo" class="pagination"></ul>
                
            </div>
        </div>
    </div>
</section>
<script src="/js/jquery-3.3.1.min.js"></script>
<script>
    var pageIndex = 1;
    var pagesize = 5;

    $(document).ready(function () {
        FilterHoaDon();
    });
    function LocHoaDon(){
        $("#pagination-demo").twbsPagination('destroy');
        FilterHoaDon();
    }
    function FilterHoaDon(){
        var x = document.querySelector('input[name="menu"]:checked').value;
        var data = { TrangThaiGiaoHang: x, page: pageIndex, pageSize: pagesize}
        $.ajax({
            url: "/Home/GetHoaDonByTrangThai",
            type: "GET",
            data: data,
            success: function (response) {
                $("#DShoaDon").empty();
                console.log(response.data);
                for (let i = 0; i < response.data.length; i++) {
                    $("#DShoaDon").append(`<tr>
                            <th scope="row"><a href="PurchaseOrderDetail?idHoaDon=${response.data[i].idHoaDon}">${response.data[i].maHD}</a></th>
                            <td>${response.data[i].ngayTao}</td>
                            <td>${response.data[i].tongTien} VNĐ</td>
                            <td>
                                ${response.data[i].trangThaiGiaoHang === 2 ? '<label>Chờ xác nhận</label>' :
                                    response.data[i].trangThaiGiaoHang === 3 ? '<label>Đang giao hàng</label>' :
                                    response.data[i].trangThaiGiaoHang === 4 ? '<label>Đang hoàn hàng</label>' :
                                    response.data[i].trangThaiGiaoHang === 5 ? '<label>Hoàn hàng thành công</label>' :
                                    response.data[i].trangThaiGiaoHang === 6 ? '<label>Hoàn thành</label>' :
                                    response.data[i].trangThaiGiaoHang === 7 ? '<label>Đơn hủy</label>' :
                                    response.data[i].trangThaiGiaoHang === 8 ? '<label>Chờ xác nhận hủy</label>' :
                                    '<label>Chờ xác nhận đổi trả hàng</label>'}
                            </td>
                            <td>${response.data[i].loaiHoaDon === 0 ? '<label>Mua hàng online</label>' : '<label>Mua hàng tại quầy</label>'}</td>
                        </tr>`);
                }
                paginghd(response.total, function () {
                    FilterHoaDon()
                });
            },
            error: function (err) {
                console.log('Error:', err);
            }
        });
    }
    function paginghd(totalrow, callback) {
        var totalpages = Math.ceil(totalrow / pagesize);
        $("#pagination-demo").twbsPagination({
            totalPages: totalpages,
            visiblePages: 5,
            onPageClick: function (event, page) {
                pageIndex = page;
                setTimeout(callback, 200);
            }
        });
    }
    function billDetail(id){
        window.location = 'https://localhost:5001/Home/PurchaseOrderDetail?idHoaDon=';
    }
</script>